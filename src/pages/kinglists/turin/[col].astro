---
import Layout from "../../../layouts/Layout.astro";
import turinData from "../../../data/kl_turin.json";
import faraos from "../../../data/pharaohs.json";
export async function getStaticPaths() {
	const cols = Array.from(new Set(turinData.map((item) => item.col))).sort((a, b) => a - b);
	return cols.map((col) => ({
		params: { col: `column-${col}` },
		props: { col, cols },
	}));
}

const { col, cols } = Astro.props;
const colStr = typeof col === "string" ? col : String(col);
const colNum = Number(colStr.replace("column-", ""));
const rows = turinData.filter((item) => item.col === colNum);
---

<Layout title="Turin Kinglist">
	<!-- <h1 class="text-3xl font-bold mb-6">Turin Kinglist</h1> -->
	<nav class="text-center my-10">
		Column navigation
		<div class="mb-4 flex flex-wrap gap-2 w-fit mx-auto">
			{
				cols.map((c) => (
					<a
						href={`/kinglists/turin/column-${c}`}
						class={`px-3 py-1 rounded ${c === colNum ? "bg-blue-600 text-white" : "bg-gray-200 dark:bg-stone-700 dark:text-white"}`}
					>
						{c}
					</a>
				))
			}
		</div>
	</nav>
	<div class="grid grid-cols-1 gap-6 mb-8">
		{
			rows.map((item) => (
				<div class="card">
					<div class="font-bold text-lg mb-2">
						Col {item.col}, Row {item.row}
					</div>
					<div>
						<span class="font-semibold">Farao:</span>
						{(() => {
							const phEntry = faraos.find((ph) => String(ph.no) === String(item.farao));
							if (phEntry) {
								if (String(phEntry.no) === "888") {
									return " ";
								}
								if (String(phEntry.no) === "999") {
									return "â€”";
								}
								// Generate slug from name (kebab-case)
								const slug = phEntry.name.replace(/[^a-z0-9]+/gi, "-").replace(/^-+|-+$/g, "");
								return <a href={`/pharaohs/${slug}`}>{phEntry.name}</a>;
							} else {
								return item.farao;
							}
						})()}
					</div>
					<div>
						<span class="font-semibold">Translit:</span> <span class="tlit" set:html={item.tlit} />
					</div>
					<div>
						<span class="font-semibold">Transcription:</span> <span set:html={item.trans} />
					</div>
					<div class="mt-2 text-sm" set:html={item.descr ?? ""} />
				</div>
			))
		}
	</div>
</Layout>
